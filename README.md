# å‰è¨€

é«˜ä»¿é¥¿äº†ä¹ˆï¼Œä»¥nuxtä½œä¸ºvueçš„æœåŠ¡ç«¯æ¸²æŸ“ï¼Œé€‚åˆåˆšæ¥è§¦æˆ–è€…å‡†å¤‡ä¸Švue ssrçš„åŒå­¦å‚è€ƒå’Œå­¦ä¹ 

å¦‚é‡ç½‘ç»œä¸ä½³ï¼Œè¯·ç§»æ­¥[å›½å†…é•œåƒåŠ é€ŸèŠ‚ç‚¹](https://gitee.com/easytuan/nuxt-elm)

# æ•ˆæœæ¼”ç¤º

[æŸ¥çœ‹demoè¯·æˆ³è¿™é‡Œ](https://elm.caibowen.net/)ï¼ˆè¯·ç”¨chromeæ‰‹æœºæ¨¡å¼é¢„è§ˆï¼‰

### ç§»åŠ¨ç«¯æ‰«æä¸‹æ–¹äºŒç»´ç 

<img src="./screenshots/qr-code.png" width="250" height="250"/>

# APIæ¥å£æ–‡æ¡£

[æ¥å£æ–‡æ¡£åœ°å€](https://easytuan.gitee.io/node-elm-api/doc)ï¼ˆåŸºäºapidocï¼‰

# æŠ€æœ¯æ ˆ

vue2 + vuex + vue-router + mint-ui + nuxt

## é¡¹ç›®è¿è¡Œ

```

git clone git@github.com:EasyTuan/nuxt-elm.git

# å›½å†…é•œåƒåŠ é€ŸèŠ‚ç‚¹:git@gitee.com:easytuan/node-elm-api.git

cd nuxt-elm

npm install

npm run dev

#æ¨¡ç‰ˆå¿«é€Ÿç”Ÿæˆ
npm run tep `æ–‡ä»¶å`

# pm2éƒ¨ç½²
npm run start

```

## è¡¥å……

æ­¤é¡¹ç›®æœ‰é…å¥—çš„åå°ç³»ç»Ÿï¼Œå¦‚æœæƒ³ä½“éªŒå‰åå°åŒæ—¶å¼€å‘ï¼Œå¯ä»¥ä¸‹è½½å¯¹åº”çš„åå°ç³»ç»Ÿï¼š[åå°é¡¹ç›®ä¼ é€åœ°å€](https://github.com/EasyTuan/node-elm-api)ã€‚

å¦‚æœåªåšå‰ç«¯å¼€å‘ï¼Œè¯·å¿½ç•¥è¿™å¥è¯ã€‚


# ç›®æ ‡åŠŸèƒ½
- [x] å•†å®¶åˆ—è¡¨ -- å®Œæˆ
- [x] è´­ç‰©è½¦åŠŸèƒ½ -- å®Œæˆ
- [x] é¤é¦†é£Ÿå“åˆ—è¡¨é¡µ -- å®Œæˆ
- [x] åº—é“ºè¯„ä»·é¡µé¢ -- å®Œæˆ
- [x] å•†å®¶è¯¦æƒ…é¡µ -- å®Œæˆ
- [x] ç™»å½•ã€æ³¨å†Œ -- å®Œæˆ
- [x] ä¿®æ”¹å¯†ç  -- å®Œæˆ
- [x] ä¸ªäººä¸­å¿ƒ -- å®Œæˆ
- [x] çº¢åŒ… -- å®Œæˆ
- [x] æ”¶è´§åœ°å€ -- å®Œæˆ

# ä¸šåŠ¡ä»‹ç»

ç›®å½•ç»“æ„

    â”œâ”€â”€ assets               // é™æ€èµ„æº
    â”‚Â Â  â”œâ”€â”€ images                // å›¾ç‰‡èµ„æº
    â”‚Â Â  â”œâ”€â”€ services              // apiè¯·æ±‚
    â”‚Â Â  â”œâ”€â”€ styles                // æ ·å¼æ–‡ä»¶
    â”‚Â Â  â””â”€â”€ utils                 // å¸¸ç”¨å·¥å…·ç±»
    â”œâ”€â”€ components           // ç»„ä»¶
    â”œâ”€â”€ config
    â”‚Â Â  â””â”€â”€ index.js              // é…ç½®æ–‡ä»¶
    â”œâ”€â”€ layouts              // å¸ƒå±€
    â”œâ”€â”€ middleware           // ä¸­é—´ä»¶
    â”œâ”€â”€ pages                // é¡µé¢
    â”œâ”€â”€ plugins              // æ’ä»¶
    â”œâ”€â”€ static               // é™æ€èµ„æº
    â””â”€â”€ store                //vuexçŠ¶æ€æ ‘


## éƒ¨åˆ†æˆªå›¾å±•ç¤º

### é¦–é¡µå±•ç¤º

<img src="screenshots/1.png" width="375px" height="667px" /> <img src="screenshots/1.gif" width="375px" height="667px" />

### ä¸ªäººèµ„æ–™

<img src="screenshots/2.png" width="375px" height="667px" /> <img src="screenshots/2.gif" width="375px" height="667px" />

### æˆ‘çš„

<img src="screenshots/3.png" width="375px" height="667px" /> <img src="screenshots/3.gif" width="375px" height="667px" />

### è®¢é¤

<img src="screenshots/4.png" width="375px" height="667px" /> <img src="screenshots/4.gif" width="375px" height="667px" />

### å•†å®¶è¯„ä»·

<img src="screenshots/5.png" width="375px" height="667px" /> <img src="screenshots/5.gif" width="375px" height="667px" />

# è¯´æ˜

>  å¦‚æœå¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œæ‚¨å¯ä»¥ç‚¹å³ä¸Šè§’ "Star" æ”¯æŒä¸€ä¸‹ è°¢è°¢ï¼ ^_^

>  æˆ–è€…æ‚¨å¯ä»¥ "follow" ä¸€ä¸‹ï¼Œæˆ‘ä¼šä¸æ–­å¼€æºæ›´å¤šçš„æœ‰è¶£çš„é¡¹ç›®

>  å¦‚æœ‰é—®é¢˜è¯·ç›´æ¥åœ¨ Issues ä¸­æï¼Œæˆ–è€…æ‚¨å‘ç°é—®é¢˜å¹¶æœ‰éå¸¸å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ¬¢è¿ PR ğŸ‘

# å¼€å‘æ—¥å¸¸è®°å½•

### nuxtæ¨¡ç‰ˆæ­å»º

è¿™é‡Œå…³äºé¡¹ç›®åˆå§‹åŒ–ï¼Œæˆ‘æ˜¯ç›´æ¥ä½¿ç”¨çš„ `Nuxt` å®˜ç½‘æä¾›çš„ starter æ¨¡æ¿

```shell

# å®‰è£… vue-cli
npm install -g vue-cli

# åˆå§‹åŒ–é¡¹ç›®
vue init nuxt-community/starter-template nuxt-ssr-demo

# å®‰è£…ä¾èµ–
cd nuxt-ssr-demo
npm install

# å¯åŠ¨æœ¬åœ°æœåŠ¡
npm run dev

```

è®¿é—® http://localhost:3000 ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸‹åˆå§‹åŒ–å¥½çš„é¡¹ç›®ç›®å½•

```shell

â”œâ”€â”€ assets                      // é™æ€èµ„æº
â”œâ”€â”€ components                  // å…¨å±€ç»„ä»¶
â”œâ”€â”€ layouts                     // é¡µé¢å¸ƒå±€
â”œâ”€â”€ middleware                  // ä¸­é—´ä»¶
â”œâ”€â”€ pages                       // è·¯ç”±é¡µé¢
â”œâ”€â”€ static                      // é™æ€èµ„æºï¼Œæ‰“åŒ…æ–‡ä»¶åä¸ä¼šè¢«hash
â”œâ”€â”€ store                       // vuex
â”œâ”€â”€ nuxt.config.js              // nuxté…ç½®æ–‡ä»¶
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md

```

æ³¨æ„ï¼šnuxté»˜è®¤ä¼šè¯»å–pagesé‡Œé¢çš„vueæ–‡ä»¶ï¼Œè‡ªåŠ¨ç”Ÿæˆè·¯ç”±ï¼Œå¦‚éœ€è¦è‡ªå®šä¹‰è·¯ç”±ï¼Œå¯åœ¨nuxt.config.jsä¸­é…ç½®å¯¹åº”å‚æ•°ã€‚

### requestè¯·æ±‚å°è£…

æ•°æ®å’Œå±•ç¤ºå±‚çš„å‰¥ç¦»æ˜¯æœ‰å¿…è¦çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå‰ç«¯éƒ½æå€¡MV*çš„è®¾è®¡æ¨¡å¼ï¼Œè€Œå¯¹requestè¯·æ±‚å°è£…æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ­¥è¦å®Œæˆçš„ã€‚è¿™é‡Œæˆ‘é€‰äº†axiosä½œä¸ºHTTPè¯·æ±‚å®¢æˆ·ç«¯ï¼Œaxioså…¼å®¹æµè§ˆå™¨ç«¯å’Œnodeç«¯ï¼ŒåŒæ—¶æä¾›äº†è¯·æ±‚æ‹¦æˆªã€å“åº”æ‹¦æˆªç­‰è®©æˆ‘ä»¬å¼€å‘æ›´åŠ æ„‰å¿«çš„åŠŸèƒ½ã€‚

åœ¨ `config/index.js` ä¸­å†™å…¥ï¼š

```

const json = require('../package.json');
const port = json.config.nuxt.port;

module.exports = {
  IS_RELEASE: true, // trueçº¿ä¸Šï¼Œfalseæµ‹è¯•

  BASE_URL: `http://localhost:${port}/api`, // æµ‹è¯•

  // BASE_URL: `https://elm.caibowen.net/api`, // ç”Ÿäº§

  // IMG_URL: 'http://localhost:9000/', // æµ‹è¯•

  IMG_URL: 'https://easytuan.gitee.io/node-elm-api/public/', // ç”Ÿäº§ï¼ˆä½¿ç”¨ç äº‘Gitee Pages æœåŠ¡ï¼‰

  HEADERS: {
    'Content-Type': 'application/json;charset=UTF-8'
  },

  TIMEOUT: 12000, // apiè¶…æ—¶æ—¶é—´

};

```

åœ¨ `assets/utils/request.js` ä¸­å†™å…¥ï¼š

```

import axios from 'axios';
import config from '~/config';
import { Toast } from 'mint-ui';

axios.defaults.baseURL = config.BASE_URL;
axios.defaults.timeout = config.TIMEOUT;
axios.defaults.headers = config.HEADERS;

// è¯·æ±‚æ‹¦æˆªå™¨
axios.interceptors.request.use( request => {
  if (!config.IS_RELEASE) {
    console.log(
      `${new Date().toLocaleString()}ã€ M=${request.url} ã€‘P=`,
      request.params || request.data,
    );
  }
  return request;
}, error => {
  return Promise.reject(error);
});

export default async (options = { method: 'GET' }) => {
  let isdata = true;
  if (
    options.method.toUpperCase() !== 'POST'
    && options.method.toUpperCase() !== 'PUT'
    && options.method.toUpperCase() !== 'PATCH'
  ) {
    isdata = false;
  }
  const res = await axios({
    method: options.method,
    url: options.url,
    data: isdata ? options.data : null,
    params: !isdata ? options.data : null,
  });
  if (res.status >= 200 && res.status < 300) {
    if (!config.IS_RELEASE) {
      console.log(
        `${new Date().toLocaleString()}ã€æ¥å£å“åº”ï¼šã€‘`,
        res.data,
      );
    }
    // æµè§ˆå™¨ç¯å¢ƒå¼¹å‡ºæŠ¥é”™ä¿¡æ¯
    if(typeof window !== "undefined" && res.data.code !== 0) {
      Toast(res.data.msg);
    }
    return res.data;
  }else {
    if(typeof window !== "undefined" && res.data.code !== 0) {
      Toast('è¯·æ±‚é”™è¯¯');
    }
  }

};

```

æœ€åæ‰€æœ‰apiè¯·æ±‚éƒ½å†™è¿›server.jsæ–‡ä»¶ï¼Œæ–¹ä¾¿ç»Ÿä¸€ç®¡ç†ã€‚

### è·¨åŸŸå¤„ç†

ä½¿ç”¨è¿‡ `vue` çš„åŒå­¦ï¼Œè‚¯å®šçŸ¥é“å¯¹äºé¡¹ç›®ä¸­çš„è·¨åŸŸï¼Œ`vue-cli` å¯¹ `webpack` ä¸­çš„ `proxy` é€‰é¡¹è¿›è¡Œäº†ä¸€å±‚å°è£…ã€‚å®ƒæš´éœ²å‡ºæ¥çš„æ˜¯ä¸€ä¸ªå« `proxyTable` çš„é€‰é¡¹ï¼Œæ˜¯å¯¹ `webpack` ä¸­çš„ `proxy` å’Œå…¶ä¸‰æ–¹æ’ä»¶ `http-proxy-middleware` çš„ä¸€ä¸ªæ•´åˆã€‚

ä¸å¹¸çš„ `Nuxt` ä¸­æ²¡æœ‰ `proxyTable` è¿™ä¹ˆä¸€ä¸ªé…ç½®é¡¹æ¥è¿›è¡Œè·¨åŸŸçš„é…ç½®ã€‚å½“ç„¶å¹¸è¿çš„æ˜¯ï¼Œåœ¨ `Nuxt` ä¸­ä½ å¯ä»¥ç›´æ¥é€šè¿‡é…ç½® `http-proxy-middleware`  æ¥å¤„ç†è·¨åŸŸã€‚æ›´å¹¸è¿çš„æ˜¯ `Nuxt` å®˜æ–¹æä¾›äº†ä¸¤ä¸ªåŒ…æ¥å¤„ç† `axios` è·¨åŸŸé—®é¢˜ã€‚

- [@nuxtjs/axios](https://www.npmjs.com/package/@nuxtjs/axios)
- [@nuxtjs/proxy](https://www.npmjs.com/package/@nuxtjs/proxy)

é¦–å…ˆï¼Œè¿›è¡Œå®‰è£…

```shell
npm i @nuxtjs/axios @nuxtjs/proxy -D
```

ç„¶ååœ¨ `nuxt.config.js` æ–‡ä»¶é‡Œè¿›è¡Œé…ç½®

```
  modules: [
    '@nuxtjs/axios',
    '@nuxtjs/proxy'
  ],
  proxy: [
    [
      '/api',{
        // target: 'http://localhost:9000',
        target: 'https://elm-api.caibowen.net',
        changeOrigin: true,
        pathRewrite: { '^/api' : '/' }
      }
    ]
  ],
```

ç„¶åä½ å°±å¯ä»¥å®‰å¿ƒä½¿ç”¨ä½ çš„ axios è¿›è¡Œè·¨åŸŸè¯·æ±‚äº†

### é¡¹ç›®éƒ¨ç½²

åˆ°è¿™ä¸€æ­¥çš„åŒå­¦ï¼Œä½ å¾—å…ˆç¡®ä¿ä½ æ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„æœåŠ¡å™¨ã€‚å¦‚æœæ²¡æœ‰çš„è¯ï¼Œèµ¶ç´§å»ä¹°ä¸€ä¸ªï¼ˆæˆ‘ä¸ä¼šå’Œä½ è¯´AWSå’Œgoogleäº‘æœ‰æä¾›å…è´¹ä¸€å¹´çš„äº‘æœåŠ¡å™¨è¯•ç”¨ï¼‰


OKï¼Œæ–‡ç« ç»§ç»­ã€‚åœ¨è¿›è¡Œéƒ¨ç½²è®²è§£å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ `Nuxt` æä¾›çš„å‡ ä¸ªå‘½ä»¤

| å‘½ä»¤            | æè¿°                                       |
| ------------- | ---------------------------------------- |
| nuxt          | å¯åŠ¨ä¸€ä¸ªçƒ­åŠ è½½çš„ Web æœåŠ¡å™¨ï¼ˆå¼€å‘æ¨¡å¼ï¼‰ [localhost:3000](http://localhost:3000/) |
| nuxt build    | åˆ©ç”¨ webpack ç¼–è¯‘åº”ç”¨ï¼Œå‹ç¼© JS å’Œ CSS èµ„æºï¼ˆå‘å¸ƒç”¨ï¼‰      |
| nuxt start    | ä»¥ç”Ÿæˆæ¨¡å¼å¯åŠ¨ä¸€ä¸ª Web æœåŠ¡å™¨ (`nuxt build` ä¼šå…ˆè¢«æ‰§è¡Œ)   |
| nuxt generate | ç¼–è¯‘åº”ç”¨ï¼Œå¹¶ä¾æ®è·¯ç”±é…ç½®ç”Ÿæˆå¯¹åº”çš„ HTML æ–‡ä»¶ (ç”¨äºé™æ€ç«™ç‚¹çš„éƒ¨ç½²)    |


#### å¼€å§‹éƒ¨ç½²


ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤nuxt build && nuxt start ç›‘å¬3000ç«¯å£ã€‚
æ¥ä¸‹æ¥ï¼Œå¼€å§‹é…ç½®ä½ çš„ nginx ï¼ˆç”¨äºç«¯å£è½¬å‘ï¼‰

```
 server {
  # ç«¯å£ï¼Œhttpä¸º 80ï¼Œå¦‚æœéƒ¨ç½²äº†httpsè¯·ç›‘å¬ 443
  listen 80;
  # åŸŸå
  server_name elm.caibowen.net;
  # åå‘ä»£ç†
  location / {
    proxy_pass http://localhost:3000;
  }
}
```

ç„¶åé‡å¯ nginx

```
nginx -s restart
```

ç„¶åä½ å°±èƒ½åœ¨ http://elm.caibowen.net è®¿é—®åˆ°ä½ çš„ç½‘ç«™å•¦


### æœ€å

å¯¹äº `Nuxt`ï¼Œåœ¨ä½¿ç”¨å±‚é¢ï¼Œæ˜¯æ¯”è¾ƒç®€å•ã€å¥½ä¸Šæ‰‹çš„ã€‚ç›¸å¯¹ vue-ssr æ¥è¯´ï¼Œå®ƒå¤§å¤§çš„ç®€åŒ–äº†å¼€å‘çš„é…ç½®ï¼Œè®©å¼€å‘äººå‘˜å¯ä»¥åªéœ€æ€è€ƒä¸šåŠ¡çš„å¼€å‘ï¼Œè€Œä¸ç”¨å¤ªå»æ‹…å¿ƒæ–‡ä»¶çš„é…ç½®ã€‚å…¶ä¸­ `Nuxt` é€šè¿‡ç›‘å¬ pages ç›®å½•æ–‡ä»¶å˜æ›´å¹¶è‡ªåŠ¨ç”Ÿæˆè·¯ç”±æ›´æ˜¯ç›´æ¥çœå»äº†æˆ‘ä»¬å¹³å¸¸å¯¹äºè·¯ç”±çš„é…ç½®ã€‚

ä½†æ˜¯ï¼Œç›®å‰ `Nuxt` æ•´ä½“è¿˜æ˜¯æœ‰å¾…æé«˜çš„ï¼Œç›®å‰ç¤¾åŒºç›¸å…³çš„ä¸‰æ–¹æ’ä»¶æ¯”è¾ƒæœ‰é™ï¼Œå¸‚é¢ä¸Šç›¸å…³çš„å‚è€ƒèµ„æ–™ä¹Ÿç›¸å¯¹æ¯”è¾ƒå°‘ã€‚

ä¸ç®¡å¦‚ä½•ï¼Œå¸Œæœ› `Nuxt` ç¤¾åŒºå¯ä»¥è¶Šæ¥è¶Šå¥½å§ ~

# æåŠ©

å¦‚æœ‰å¸®åŠ©ï¼Œæ¬¢è¿æ‰“èµ

<img src="screenshots/wechat.jpg" width="200px" /> <img src="screenshots/alipay.jpg" width="200px" />

# å‹æƒ…é“¾æ¥

[é¡¹ç›®åå°åœ°å€](https://github.com/EasyTuan/node-elm-api)

# License

[GPL](LICENSE)
